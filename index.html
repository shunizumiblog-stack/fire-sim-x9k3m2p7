<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FIREã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            color: #6c757d;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            background: white;
            color: #667eea;
            font-weight: bold;
            border-bottom: 3px solid #667eea;
        }
        
        .tab-content {
            display: none;
            padding: 30px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 600;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .section-title {
            font-size: 1.5em;
            color: #667eea;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            cursor: pointer;
            transition: transform 0.3s;
            margin-top: 20px;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin-left: 10px;
        }
        
        .result-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
        }
        
        .fire-style-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .fire-style-box h3 {
            font-size: 1.8em;
            margin-bottom: 10px;
        }
        
        .fire-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .fire-info-item {
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 8px;
        }
        
        .fire-info-item strong {
            display: block;
            margin-bottom: 5px;
            font-size: 0.9em;
        }
        
        .fire-info-item span {
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .table-container {
            overflow-x: auto;
            margin: 20px 0;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9em;
        }
        
        th {
            background: #667eea;
            color: white;
            padding: 12px 8px;
            text-align: center;
            position: sticky;
            top: 0;
            font-size: 0.85em;
        }
        
        td {
            padding: 10px 8px;
            border-bottom: 1px solid #dee2e6;
            text-align: right;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .important-col {
            background: #e7f3ff;
            font-weight: bold;
        }
        
        .chart-container {
            position: relative;
            height: 400px;
            margin: 30px 0;
        }
        
        .chart-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(600px, 1fr));
            gap: 30px;
            margin-top: 30px;
        }
        
        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 4px;
        }
        
        .help-text {
            font-size: 0.9em;
            color: #6c757d;
            margin-top: 5px;
        }
        
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .chart-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ’° FIREã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼</h1>
            <p>ã‚ãªãŸã®FIREé”æˆã¾ã§ã®é“ã®ã‚Šã‚’å¯è¦–åŒ–ã—ã¾ã™</p>
        </div>
        
        <div class="tabs">
            <button class="tab active" onclick="switchTab('basic')">åŸºæœ¬è¨­å®š</button>
            <button class="tab" onclick="switchTab('assets')">ç¾åœ¨è³‡ç”£</button>
            <button class="tab" onclick="switchTab('loan')">ä½å®…ãƒ­ãƒ¼ãƒ³</button>
            <button class="tab" onclick="switchTab('education')">æ•™è‚²è²»</button>
            <button class="tab" onclick="switchTab('income')">åå…¥è¨­å®š</button>
            <button class="tab" onclick="switchTab('expenses')">æ”¯å‡ºè¨­å®š</button>
            <button class="tab" onclick="switchTab('results')">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³çµæœ</button>
        </div>
        
        <!-- åŸºæœ¬è¨­å®šã‚¿ãƒ– -->
        <div id="basic" class="tab-content active">
            <h2 class="section-title">åŸºæœ¬è¨­å®š</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>ç¾åœ¨ã®å¹´é½¢</label>
                    <input type="number" id="currentAge" value="35" min="20" max="80">
                </div>
                <div class="form-group">
                    <label>é…å¶è€…ã®å¹´é½¢</label>
                    <input type="number" id="spouseAge" value="33" min="0" max="80">
                    <span class="help-text">â€»é…å¶è€…ãŒã„ãªã„å ´åˆã¯0ã‚’å…¥åŠ›</span>
                </div>
                <div class="form-group">
                    <label>æƒ³å®šå¯¿å‘½</label>
                    <input type="number" id="lifeExpectancy" value="95" min="60" max="120">
                </div>
                <div class="form-group">
                    <label>FIREç›®æ¨™å¹´é½¢</label>
                    <input type="number" id="fireAge" value="45" min="30" max="80">
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 30px;">å®¶æ—æ§‹æˆ</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>å­ã©ã‚‚ã®äººæ•°</label>
                    <select id="numChildren">
                        <option value="0">0äºº</option>
                        <option value="1">1äºº</option>
                        <option value="2" selected>2äºº</option>
                        <option value="3">3äºº</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ç¬¬1å­ã®ç¾åœ¨å¹´é½¢</label>
                    <input type="number" id="child1Age" value="5" min="0" max="30">
                </div>
                <div class="form-group">
                    <label>ç¬¬2å­ã®ç¾åœ¨å¹´é½¢</label>
                    <input type="number" id="child2Age" value="3" min="0" max="30">
                </div>
            </div>
            
            <button class="btn-primary" onclick="saveData(); switchTab('assets')">æ¬¡ã¸ï¼šç¾åœ¨è³‡ç”£ â†’</button>
        </div>
        
        <!-- ç¾åœ¨è³‡ç”£ã‚¿ãƒ– -->
        <div id="assets" class="tab-content">
            <h2 class="section-title">ç¾åœ¨è³‡ç”£</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>ç·é‡‘èè³‡ç”£ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="totalAssets" value="2000" min="0">
                </div>
                <div class="form-group">
                    <label>ç”Ÿæ´»é˜²è¡›è³‡é‡‘ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="emergencyFund" value="360" min="0">
                    <span class="help-text">â€»æ¨å¥¨ï¼šæœˆé¡ç”Ÿæ´»è²»Ã—12ãƒ¶æœˆ</span>
                </div>
                <div class="form-group">
                    <label>æƒ³å®šé‹ç”¨åˆ©å›ã‚Šï¼ˆå¹´%ï¼‰</label>
                    <input type="number" id="returnRate" value="5" min="0" max="20" step="0.1">
                </div>
                <div class="form-group">
                    <label>æœˆé¡ç©ç«‹æŠ•è³‡é¡ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="monthlyInvestment" value="5" min="0">
                </div>
            </div>
            
            <button class="btn-primary" onclick="saveData(); switchTab('loan')">æ¬¡ã¸ï¼šä½å®…ãƒ­ãƒ¼ãƒ³ â†’</button>
        </div>
        
        <!-- ä½å®…ãƒ­ãƒ¼ãƒ³ã‚¿ãƒ– -->
        <div id="loan" class="tab-content">
            <h2 class="section-title">ä½å®…ãƒ­ãƒ¼ãƒ³</h2>
            <div class="form-group">
                <label>ä½å®…ãƒ­ãƒ¼ãƒ³ã®æœ‰ç„¡</label>
                <select id="hasLoan" onchange="toggleLoanFields()">
                    <option value="yes">ã‚ã‚‹</option>
                    <option value="no">ãªã„</option>
                </select>
            </div>
            
            <div id="loanFields">
                <div class="form-row">
                    <div class="form-group">
                        <label>å€Ÿå…¥æ®‹é«˜ï¼ˆä¸‡å††ï¼‰</label>
                        <input type="number" id="loanBalance" value="4900" min="0">
                    </div>
                    <div class="form-group">
                        <label>è¿”æ¸ˆæœŸé–“ï¼ˆæ®‹ã‚Šå¹´æ•°ï¼‰</label>
                        <input type="number" id="loanYears" value="30" min="1" max="50">
                    </div>
                    <div class="form-group">
                        <label>é‡‘åˆ©ã‚¿ã‚¤ãƒ—</label>
                        <select id="loanType" onchange="toggleRateScenario()">
                            <option value="fixed">å›ºå®šé‡‘åˆ©</option>
                            <option value="variable">å¤‰å‹•é‡‘åˆ©</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ç¾åœ¨ã®é‡‘åˆ©ï¼ˆå¹´%ï¼‰</label>
                        <input type="number" id="currentRate" value="0.5" min="0" max="10" step="0.01">
                    </div>
                </div>
                
                <div id="rateScenario" style="display:none;">
                    <h3 class="section-title">é‡‘åˆ©ä¸Šæ˜‡ã‚·ãƒŠãƒªã‚ª</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>5å¹´å¾Œã¾ã§ã®é‡‘åˆ©ï¼ˆå¹´%ï¼‰</label>
                            <input type="number" id="rate5y" value="0.5" min="0" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>10å¹´å¾Œã¾ã§ã®é‡‘åˆ©ï¼ˆå¹´%ï¼‰</label>
                            <input type="number" id="rate10y" value="1.0" min="0" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>15å¹´å¾Œä»¥é™ã®é‡‘åˆ©ï¼ˆå¹´%ï¼‰</label>
                            <input type="number" id="rate15y" value="1.5" min="0" max="10" step="0.1">
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="btn-primary" onclick="saveData(); switchTab('education')">æ¬¡ã¸ï¼šæ•™è‚²è²» â†’</button>
        </div>
        
        <!-- æ•™è‚²è²»ã‚¿ãƒ– -->
        <div id="education" class="tab-content">
            <h2 class="section-title">æ•™è‚²è²»</h2>
            <div class="note">
                <strong>ğŸ’¡ ãƒ’ãƒ³ãƒˆ</strong><br>
                ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³ã§é¸æŠã™ã‚‹ã¨è‡ªå‹•ã§é‡‘é¡ãŒå…¥ã‚Šã¾ã™ã€‚å€‹åˆ¥ã«é‡‘é¡ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã¯ç›´æ¥å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
            </div>
            
            <h3 style="margin-top: 20px; color: #667eea;">ç¬¬1å­ã®æ•™è‚²è²»</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>å¹¼ç¨šåœ’ï¼ˆ3å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child1Kinder" onchange="updateEducationCost('child1Kinder', 'child1KinderCost')">
                        <option value="48">å…¬ç«‹ï¼ˆ48ä¸‡å††ï¼‰</option>
                        <option value="93">ç§ç«‹ï¼ˆ93ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child1KinderCost" value="48" min="0">
                </div>
                <div class="form-group">
                    <label>å°å­¦æ ¡ï¼ˆ6å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child1Elem" onchange="updateEducationCost('child1Elem', 'child1ElemCost')">
                        <option value="210">å…¬ç«‹ï¼ˆ210ä¸‡å††ï¼‰</option>
                        <option value="1002">ç§ç«‹ï¼ˆ1002ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child1ElemCost" value="210" min="0">
                </div>
                <div class="form-group">
                    <label>ä¸­å­¦æ ¡ï¼ˆ3å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child1Junior" onchange="updateEducationCost('child1Junior', 'child1JuniorCost')">
                        <option value="162">å…¬ç«‹ï¼ˆ162ä¸‡å††ï¼‰</option>
                        <option value="432">ç§ç«‹ï¼ˆ432ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child1JuniorCost" value="162" min="0">
                </div>
                <div class="form-group">
                    <label>é«˜æ ¡ï¼ˆ3å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child1High" onchange="updateEducationCost('child1High', 'child1HighCost')">
                        <option value="153">å…¬ç«‹ï¼ˆ153ä¸‡å††ï¼‰</option>
                        <option value="315">ç§ç«‹ï¼ˆ315ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child1HighCost" value="153" min="0">
                </div>
                <div class="form-group">
                    <label>å¤§å­¦ï¼ˆ4å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child1Univ" onchange="updateEducationCost('child1Univ', 'child1UnivCost')">
                        <option value="400">å›½ç«‹è‡ªå®…ï¼ˆ400ä¸‡å††ï¼‰</option>
                        <option value="600">å›½ç«‹ä¸‹å®¿ï¼ˆ600ä¸‡å††ï¼‰</option>
                        <option value="520">ç§ç«‹æ–‡ç³»è‡ªå®…ï¼ˆ520ä¸‡å††ï¼‰</option>
                        <option value="720">ç§ç«‹æ–‡ç³»ä¸‹å®¿ï¼ˆ720ä¸‡å††ï¼‰</option>
                        <option value="640">ç§ç«‹ç†ç³»è‡ªå®…ï¼ˆ640ä¸‡å††ï¼‰</option>
                        <option value="840">ç§ç«‹ç†ç³»ä¸‹å®¿ï¼ˆ840ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child1UnivCost" value="400" min="0">
                </div>
            </div>
            
            <h3 style="margin-top: 30px; color: #667eea;">ç¬¬2å­ã®æ•™è‚²è²»</h3>
            <div class="form-row">
                <div class="form-group">
                    <label>å¹¼ç¨šåœ’ï¼ˆ3å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child2Kinder" onchange="updateEducationCost('child2Kinder', 'child2KinderCost')">
                        <option value="48">å…¬ç«‹ï¼ˆ48ä¸‡å††ï¼‰</option>
                        <option value="93">ç§ç«‹ï¼ˆ93ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child2KinderCost" value="48" min="0">
                </div>
                <div class="form-group">
                    <label>å°å­¦æ ¡ï¼ˆ6å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child2Elem" onchange="updateEducationCost('child2Elem', 'child2ElemCost')">
                        <option value="210">å…¬ç«‹ï¼ˆ210ä¸‡å††ï¼‰</option>
                        <option value="1002">ç§ç«‹ï¼ˆ1002ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child2ElemCost" value="210" min="0">
                </div>
                <div class="form-group">
                    <label>ä¸­å­¦æ ¡ï¼ˆ3å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child2Junior" onchange="updateEducationCost('child2Junior', 'child2JuniorCost')">
                        <option value="162">å…¬ç«‹ï¼ˆ162ä¸‡å††ï¼‰</option>
                        <option value="432">ç§ç«‹ï¼ˆ432ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child2JuniorCost" value="162" min="0">
                </div>
                <div class="form-group">
                    <label>é«˜æ ¡ï¼ˆ3å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child2High" onchange="updateEducationCost('child2High', 'child2HighCost')">
                        <option value="153">å…¬ç«‹ï¼ˆ153ä¸‡å††ï¼‰</option>
                        <option value="315">ç§ç«‹ï¼ˆ315ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child2HighCost" value="153" min="0">
                </div>
                <div class="form-group">
                    <label>å¤§å­¦ï¼ˆ4å¹´é–“ç·é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <select id="child2Univ" onchange="updateEducationCost('child2Univ', 'child2UnivCost')">
                        <option value="400">å›½ç«‹è‡ªå®…ï¼ˆ400ä¸‡å††ï¼‰</option>
                        <option value="600">å›½ç«‹ä¸‹å®¿ï¼ˆ600ä¸‡å††ï¼‰</option>
                        <option value="520">ç§ç«‹æ–‡ç³»è‡ªå®…ï¼ˆ520ä¸‡å††ï¼‰</option>
                        <option value="720">ç§ç«‹æ–‡ç³»ä¸‹å®¿ï¼ˆ720ä¸‡å††ï¼‰</option>
                        <option value="640">ç§ç«‹ç†ç³»è‡ªå®…ï¼ˆ640ä¸‡å††ï¼‰</option>
                        <option value="840">ç§ç«‹ç†ç³»ä¸‹å®¿ï¼ˆ840ä¸‡å††ï¼‰</option>
                    </select>
                    <input type="number" id="child2UnivCost" value="400" min="0">
                </div>
            </div>
            
            <button class="btn-primary" onclick="saveData(); switchTab('income')">æ¬¡ã¸ï¼šåå…¥è¨­å®š â†’</button>
        </div>
        
        <!-- åå…¥è¨­å®šã‚¿ãƒ– -->
        <div id="income" class="tab-content">
            <h2 class="section-title">æœ¬æ¥­åå…¥</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>ç¾åœ¨ã®å¹´åï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="currentIncome" value="800" min="0">
                </div>
                <div class="form-group">
                    <label>æ˜‡çµ¦ç‡ï¼ˆå¹´%ï¼‰</label>
                    <input type="number" id="salaryGrowth" value="1" min="0" max="10" step="0.1">
                </div>
                <div class="form-group">
                    <label>é€€è·é‡‘ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="retirement" value="500" min="0">
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 30px;">å‰¯æ¥­åå…¥</h2>
            <div class="form-group">
                <label>å‰¯æ¥­ã‚’ã™ã‚‹</label>
                <select id="hasSideJob" onchange="toggleSideJobFields()">
                    <option value="yes">ã¯ã„</option>
                    <option value="no">ã„ã„ãˆ</option>
                </select>
            </div>
            
            <div id="sideJobFields">
                <div class="form-row">
                    <div class="form-group">
                        <label>ç¾åœ¨ã®å‰¯æ¥­æœˆåï¼ˆä¸‡å††ï¼‰</label>
                        <input type="number" id="sideJobNow" value="2.5" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>ãƒ•ã‚§ãƒ¼ã‚º1ï¼ˆã€œ5å¹´å¾Œï¼‰æœˆåï¼ˆä¸‡å††ï¼‰</label>
                        <input type="number" id="sideJobPhase1" value="2.5" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>ãƒ•ã‚§ãƒ¼ã‚º2ï¼ˆ6ã€œ10å¹´å¾Œï¼‰æœˆåï¼ˆä¸‡å††ï¼‰</label>
                        <input type="number" id="sideJobPhase2" value="10" min="0" step="0.1">
                    </div>
                    <div class="form-group">
                        <label>ãƒ•ã‚§ãƒ¼ã‚º3ï¼ˆ11å¹´å¾Œã€œï¼‰æœˆåï¼ˆä¸‡å††ï¼‰</label>
                        <input type="number" id="sideJobPhase3" value="15" min="0" step="0.1">
                    </div>
                </div>
                <div class="form-group">
                    <label>å‰¯æ¥­ã®çµ‚äº†æ™‚æœŸ</label>
                    <select id="sideJobEnd" onchange="toggleSideJobEndAge()">
                        <option value="continue">ç¶™ç¶šã™ã‚‹</option>
                        <option value="age">ã€‡æ­³ã§çµ‚äº†</option>
                    </select>
                </div>
                <div class="form-group" id="sideJobEndAgeField" style="display:none;">
                    <label>çµ‚äº†å¹´é½¢</label>
                    <input type="number" id="sideJobEndAge" value="65" min="40" max="100">
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 30px;">FIREå¾Œã®åŠ´åƒåå…¥</h2>
            <div class="form-group">
                <label>FIREå¾Œã‚‚åƒã</label>
                <select id="hasFireWork" onchange="toggleFireWorkFields()">
                    <option value="yes">ã¯ã„</option>
                    <option value="no">ã„ã„ãˆ</option>
                </select>
            </div>
            
            <div id="fireWorkFields">
                <div class="form-row">
                    <div class="form-group">
                        <label>æ™‚çµ¦ï¼ˆå††ï¼‰</label>
                        <input type="number" id="hourlyWage" value="1500" min="0">
                    </div>
                    <div class="form-group">
                        <label>é€±ã®å‹¤å‹™æ—¥æ•°ï¼ˆæ—¥ï¼‰</label>
                        <input type="number" id="workDays" value="3" min="1" max="7">
                    </div>
                    <div class="form-group">
                        <label>1æ—¥ã®å‹¤å‹™æ™‚é–“ï¼ˆæ™‚é–“ï¼‰</label>
                        <input type="number" id="workHours" value="6" min="1" max="12">
                    </div>
                    <div class="form-group">
                        <label>åŠ´åƒçµ‚äº†å¹´é½¢</label>
                        <input type="number" id="fireWorkEndAge" value="65" min="40" max="100">
                    </div>
                </div>
            </div>
            
            <button class="btn-primary" onclick="saveData(); switchTab('expenses')">æ¬¡ã¸ï¼šæ”¯å‡ºè¨­å®š â†’</button>
        </div>
        
        <!-- æ”¯å‡ºè¨­å®šã‚¿ãƒ– -->
        <div id="expenses" class="tab-content">
            <h2 class="section-title">ç”Ÿæ´»è²»</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>ç¾åœ¨ã®æœˆé¡ç”Ÿæ´»è²»ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="monthlyExpenses" value="30" min="0">
                </div>
                <div class="form-group">
                    <label>FIREå¾Œã®ç”Ÿæ´»è²»ï¼ˆç¾åœ¨ã®%ï¼‰</label>
                    <input type="number" id="fireExpensesRate" value="80" min="0" max="150">
                    <span class="help-text">â€»é€šå‹¤è²»ãƒ»æ˜¼é£Ÿä»£ãŒæ¸›ã‚‹æƒ³å®š</span>
                </div>
            </div>
            
            <h2 class="section-title" style="margin-top: 30px;">ãã®ä»–æ”¯å‡º</h2>
            <div class="form-row">
                <div class="form-group">
                    <label>å¹´é–“è»Šä¸¡è²»ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="carExpenses" value="50" min="0">
                    <span class="help-text">â€»ç¶­æŒè²»ï¼‹è²·ã„æ›¿ãˆè²»ç”¨ã®å¹³å‡</span>
                </div>
                <div class="form-group">
                    <label>å¹´é–“ä¿é™ºæ–™ï¼ˆä¸‡å††ï¼‰</label>
                    <input type="number" id="insurance" value="40" min="0">
                </div>
                <div class="form-group">
                    <label>ä½å®…ä¿®ç¹•è²»ï¼ˆ10å¹´ã”ã¨ãƒ»ä¸‡å††ï¼‰</label>
                    <input type="number" id="houseRepair" value="100" min="0">
                </div>
                <div class="form-group">
                    <label>ãã®ä»–æ”¯å‡ºï¼ˆå¹´é¡ãƒ»ä¸‡å††ï¼‰</label>
                    <input type="number" id="otherExpenses" value="30" min="0">
                </div>
            </div>
            
            <button class="btn-primary" onclick="calculate()">ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ ğŸš€</button>
        </div>
        
        <!-- çµæœã‚¿ãƒ– -->
        <div id="results" class="tab-content">
            <div id="resultsContent">
                <div class="note">
                    <strong>ğŸ“Š ä½¿ã„æ–¹</strong><br>
                    å„ã‚¿ãƒ–ã§æƒ…å ±ã‚’å…¥åŠ›ã—ã€ã€Œã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰èªè¨¼
        (function() {
            const correctPassword = "fire2024premium";
            const authKey = "fireSimulatorAuth";
            
            // æ—¢ã«èªè¨¼æ¸ˆã¿ã‹ãƒã‚§ãƒƒã‚¯
            const savedAuth = sessionStorage.getItem(authKey);
            
            if (savedAuth !== correctPassword) {
                let attempts = 0;
                while (attempts < 3) {
                    const inputPassword = prompt("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š");
                    
                    if (inputPassword === null) {
                        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸ
                        document.body.innerHTML = "<div style='text-align:center;padding:50px;font-size:20px;'>ã‚¢ã‚¯ã‚»ã‚¹ãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã—ãŸ</div>";
                        throw new Error("Authentication cancelled");
                    }
                    
                    if (inputPassword === correctPassword) {
                        sessionStorage.setItem(authKey, correctPassword);
                        break;
                    }
                    
                    attempts++;
                    if (attempts < 3) {
                        alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™ã€‚ã‚‚ã†ä¸€åº¦å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
                    } else {
                        document.body.innerHTML = "<div style='text-align:center;padding:50px;font-size:20px;color:red;'>èªè¨¼ã«å¤±æ•—ã—ã¾ã—ãŸã€‚æ­£ã—ã„ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</div>";
                        throw new Error("Authentication failed");
                    }
                }
            }
        })();
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let cashflowData = [];
        let charts = {};
        
        // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
            
            saveData();
        }
        
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜
        function saveData() {
            const formData = {};
            document.querySelectorAll('input, select').forEach(el => {
                formData[el.id] = el.value;
            });
            localStorage.setItem('fireSimulator', JSON.stringify(formData));
        }
        
        // ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        function loadData() {
            const saved = localStorage.getItem('fireSimulator');
            if (saved) {
                const formData = JSON.parse(saved);
                Object.keys(formData).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) el.value = formData[key];
                });
                toggleLoanFields();
                toggleRateScenario();
                toggleSideJobFields();
                toggleSideJobEndAge();
                toggleFireWorkFields();
            }
        }
        
        // å„ç¨®ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰è¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ
        function toggleLoanFields() {
            const hasLoan = document.getElementById('hasLoan').value;
            document.getElementById('loanFields').style.display = hasLoan === 'yes' ? 'block' : 'none';
        }
        
        function toggleRateScenario() {
            const loanType = document.getElementById('loanType').value;
            document.getElementById('rateScenario').style.display = loanType === 'variable' ? 'block' : 'none';
        }
        
        function toggleSideJobFields() {
            const hasSideJob = document.getElementById('hasSideJob').value;
            document.getElementById('sideJobFields').style.display = hasSideJob === 'yes' ? 'block' : 'none';
        }
        
        function toggleSideJobEndAge() {
            const sideJobEnd = document.getElementById('sideJobEnd').value;
            document.getElementById('sideJobEndAgeField').style.display = sideJobEnd === 'age' ? 'block' : 'none';
        }
        
        function toggleFireWorkFields() {
            const hasFireWork = document.getElementById('hasFireWork').value;
            document.getElementById('fireWorkFields').style.display = hasFireWork === 'yes' ? 'block' : 'none';
        }
        
        function updateEducationCost(selectId, inputId) {
            const select = document.getElementById(selectId);
            const input = document.getElementById(inputId);
            input.value = select.value;
        }
        
        // ãƒ¡ã‚¤ãƒ³è¨ˆç®—é–¢æ•°
        function calculate() {
            saveData();
            
            // å…¥åŠ›å€¤å–å¾—
            const currentAge = parseInt(document.getElementById('currentAge').value);
            const lifeExpectancy = parseInt(document.getElementById('lifeExpectancy').value);
            const fireAge = parseInt(document.getElementById('fireAge').value);
            const totalAssets = parseFloat(document.getElementById('totalAssets').value);
            const emergencyFund = parseFloat(document.getElementById('emergencyFund').value);
            const returnRate = parseFloat(document.getElementById('returnRate').value) / 100;
            const monthlyInvestment = parseFloat(document.getElementById('monthlyInvestment').value);
            const inflationRate = 0.02; // 2%å›ºå®š
            
            // åˆæœŸè³‡ç”£
            let investmentAssets = totalAssets - emergencyFund;
            let currentYear = new Date().getFullYear();
            
            cashflowData = [];
            
            for (let age = currentAge; age <= lifeExpectancy; age++) {
                const year = currentYear + (age - currentAge);
                const yearsSinceStart = age - currentAge;
                
                // åå…¥è¨ˆç®—
                let mainIncome = 0;
                if (age < fireAge) {
                    const salaryGrowth = parseFloat(document.getElementById('salaryGrowth').value) / 100;
                    mainIncome = parseFloat(document.getElementById('currentIncome').value) * Math.pow(1 + salaryGrowth, yearsSinceStart);
                } else if (age === fireAge) {
                    mainIncome = parseFloat(document.getElementById('retirement').value);
                }
                
                let sideJobIncome = 0;
                if (document.getElementById('hasSideJob').value === 'yes') {
                    const endType = document.getElementById('sideJobEnd').value;
                    const endAge = endType === 'age' ? parseInt(document.getElementById('sideJobEndAge').value) : 999;
                    
                    if (age < endAge) {
                        if (yearsSinceStart <= 5) {
                            sideJobIncome = parseFloat(document.getElementById('sideJobPhase1').value) * 12;
                        } else if (yearsSinceStart <= 10) {
                            sideJobIncome = parseFloat(document.getElementById('sideJobPhase2').value) * 12;
                        } else {
                            sideJobIncome = parseFloat(document.getElementById('sideJobPhase3').value) * 12;
                        }
                    }
                }
                
                let fireWorkIncome = 0;
                if (age >= fireAge && document.getElementById('hasFireWork').value === 'yes') {
                    const endAge = parseInt(document.getElementById('fireWorkEndAge').value);
                    if (age < endAge) {
                        const hourlyWage = parseFloat(document.getElementById('hourlyWage').value) / 10000;
                        const workDays = parseFloat(document.getElementById('workDays').value);
                        const workHours = parseFloat(document.getElementById('workHours').value);
                        fireWorkIncome = hourlyWage * workDays * workHours * 52;
                    }
                }
                
                // é‹ç”¨ç›Šï¼ˆæœˆæ¬¡è¤‡åˆ©ã‚’å¹´æ¬¡ã§è¿‘ä¼¼ï¼‰
                const monthlyRate = returnRate / 12;
                let yearInvestmentReturn = 0;
                for (let month = 0; month < 12; month++) {
                    yearInvestmentReturn += investmentAssets * monthlyRate;
                    investmentAssets += investmentAssets * monthlyRate + monthlyInvestment;
                }
                
                // å¹´é‡‘ï¼ˆç°¡æ˜“è¨ˆç®—ï¼‰
                let pension = 0;
                if (age >= 65) {
                    if (document.getElementById('hasFireWork').value === 'yes' && age < parseInt(document.getElementById('fireWorkEndAge').value)) {
                        pension = 180; // åšç”Ÿå¹´é‡‘æƒ³å®š
                    } else {
                        pension = age >= fireAge ? 78 : 180; // ã‚µã‚¤ãƒ‰FIREãªã‚‰å›½æ°‘å¹´é‡‘
                    }
                }
                
                const totalIncome = mainIncome + sideJobIncome + fireWorkIncome + yearInvestmentReturn + pension;
                
                // æ”¯å‡ºè¨ˆç®—
                const inflationMultiplier = Math.pow(1 + inflationRate, yearsSinceStart);
                
                let monthlyExpenses = parseFloat(document.getElementById('monthlyExpenses').value) * 12;
                if (age >= fireAge) {
                    monthlyExpenses *= parseFloat(document.getElementById('fireExpensesRate').value) / 100;
                }
                monthlyExpenses *= inflationMultiplier;
                
                // æ•™è‚²è²»
                let educationCost = calculateEducationCost(age, yearsSinceStart, inflationMultiplier);
                
                // ä½å®…ãƒ­ãƒ¼ãƒ³
                let loanPayment = 0;
                if (document.getElementById('hasLoan').value === 'yes') {
                    loanPayment = calculateLoanPayment(yearsSinceStart);
                }
                
                // ãã®ä»–æ”¯å‡º
                let carExpenses = parseFloat(document.getElementById('carExpenses').value) * inflationMultiplier;
                let insurance = parseFloat(document.getElementById('insurance').value) * inflationMultiplier;
                let houseRepair = (yearsSinceStart > 0 && yearsSinceStart % 10 === 0) ? parseFloat(document.getElementById('houseRepair').value) : 0;
                let otherExpenses = parseFloat(document.getElementById('otherExpenses').value) * inflationMultiplier;
                
                // ç¨é‡‘ãƒ»ç¤¾ä¿ï¼ˆç°¡æ˜“è¨ˆç®—ï¼šåå…¥ã®20%ï¼‰
                const taxAndSocial = (mainIncome + sideJobIncome + fireWorkIncome) * 0.20;
                
                const totalExpenses = monthlyExpenses + educationCost + loanPayment + carExpenses + insurance + houseRepair + otherExpenses + taxAndSocial;
                
                const cashflow = totalIncome - totalExpenses;
                investmentAssets += cashflow - monthlyInvestment * 12;
                
                // ãƒ­ãƒ¼ãƒ³æ®‹å‚µè¨ˆç®—ï¼ˆç°¡æ˜“ï¼‰
                let loanBalance = 0;
                if (document.getElementById('hasLoan').value === 'yes') {
                    const initialBalance = parseFloat(document.getElementById('loanBalance').value);
                    const loanYears = parseInt(document.getElementById('loanYears').value);
                    if (yearsSinceStart < loanYears) {
                        loanBalance = initialBalance * (1 - yearsSinceStart / loanYears);
                    }
                }
                
                const totalAsset = investmentAssets + emergencyFund;
                const netAsset = totalAsset - loanBalance;
                
                cashflowData.push({
                    year,
                    age,
                    mainIncome: Math.round(mainIncome),
                    sideJobIncome: Math.round(sideJobIncome),
                    fireWorkIncome: Math.round(fireWorkIncome),
                    investmentReturn: Math.round(yearInvestmentReturn),
                    pension: Math.round(pension),
                    totalIncome: Math.round(totalIncome),
                    taxAndSocial: Math.round(taxAndSocial),
                    monthlyExpenses: Math.round(monthlyExpenses),
                    educationCost: Math.round(educationCost),
                    loanPayment: Math.round(loanPayment),
                    otherExpenses: Math.round(carExpenses + insurance + houseRepair + otherExpenses),
                    totalExpenses: Math.round(totalExpenses),
                    cashflow: Math.round(cashflow),
                    totalAsset: Math.round(totalAsset),
                    netAsset: Math.round(netAsset)
                });
            }
            
            displayResults();
        }
        
        function calculateEducationCost(age, yearsSinceStart, inflationMultiplier) {
            const numChildren = parseInt(document.getElementById('numChildren').value);
            let total = 0;
            
            for (let i = 1; i <= numChildren; i++) {
                const childAge = parseInt(document.getElementById(`child${i}Age`).value) + yearsSinceStart;
                
                // å¹¼ç¨šåœ’ 3-5æ­³
                if (childAge >= 3 && childAge <= 5) {
                    total += parseFloat(document.getElementById(`child${i}KinderCost`).value) / 3 * inflationMultiplier;
                }
                // å°å­¦æ ¡ 6-11æ­³
                else if (childAge >= 6 && childAge <= 11) {
                    total += parseFloat(document.getElementById(`child${i}ElemCost`).value) / 6 * inflationMultiplier;
                }
                // ä¸­å­¦æ ¡ 12-14æ­³
                else if (childAge >= 12 && childAge <= 14) {
                    total += parseFloat(document.getElementById(`child${i}JuniorCost`).value) / 3 * inflationMultiplier;
                }
                // é«˜æ ¡ 15-17æ­³
                else if (childAge >= 15 && childAge <= 17) {
                    total += parseFloat(document.getElementById(`child${i}HighCost`).value) / 3 * inflationMultiplier;
                }
                // å¤§å­¦ 18-21æ­³
                else if (childAge >= 18 && childAge <= 21) {
                    total += parseFloat(document.getElementById(`child${i}UnivCost`).value) / 4 * inflationMultiplier;
                }
            }
            
            return total;
        }
        
        function calculateLoanPayment(yearsSinceStart) {
            const loanBalance = parseFloat(document.getElementById('loanBalance').value);
            const loanYears = parseInt(document.getElementById('loanYears').value);
            const currentRate = parseFloat(document.getElementById('currentRate').value) / 100;
            
            if (yearsSinceStart >= loanYears) return 0;
            
            let rate = currentRate;
            if (document.getElementById('loanType').value === 'variable') {
                if (yearsSinceStart <= 5) {
                    rate = parseFloat(document.getElementById('rate5y').value) / 100;
                } else if (yearsSinceStart <= 10) {
                    rate = parseFloat(document.getElementById('rate10y').value) / 100;
                } else {
                    rate = parseFloat(document.getElementById('rate15y').value) / 100;
                }
            }
            
            // å…ƒåˆ©å‡ç­‰è¿”æ¸ˆã®å¹´é–“è¿”æ¸ˆé¡ï¼ˆç°¡æ˜“è¨ˆç®—ï¼‰
            const monthlyRate = rate / 12;
            const remainingMonths = (loanYears - yearsSinceStart) * 12;
            const monthlyPayment = loanBalance * monthlyRate * Math.pow(1 + monthlyRate, remainingMonths) / 
                                  (Math.pow(1 + monthlyRate, remainingMonths) - 1);
            
            return monthlyPayment * 12 / 10000; // ä¸‡å††å˜ä½
        }
        
        function displayResults() {
            // FIREã‚¹ã‚¿ã‚¤ãƒ«åˆ¤å®š
            const hasSideJob = document.getElementById('hasSideJob').value === 'yes';
            const hasFireWork = document.getElementById('hasFireWork').value === 'yes';
            
            let fireStyle = '';
            let fireStyleDesc = '';
            
            if (!hasSideJob && !hasFireWork) {
                fireStyle = 'å®Œå…¨FIRE';
                fireStyleDesc = 'ä¼šç¤¾ã‚’è¾ã‚ãŸå¾Œã€åŠ´åƒåå…¥ãªã—ã§ç”Ÿæ´»ã€‚è³‡ç”£é‹ç”¨ç›Šã¨å¹´é‡‘ã®ã¿ã§æš®ã‚‰ã—ã¾ã™ã€‚æœ€ã‚‚è³‡ç”£ãŒå¿…è¦ã§ã™ãŒã€å®Œå…¨ãªè‡ªç”±ãŒå¾—ã‚‰ã‚Œã¾ã™ã€‚';
            } else if (hasSideJob && !hasFireWork) {
                fireStyle = 'ã‚µã‚¤ãƒ‰FIRE';
                fireStyleDesc = 'ä¼šç¤¾ã‚’è¾ã‚ãŸå¾Œã€å‰¯æ¥­ï¼ˆå€‹äººäº‹æ¥­ï¼‰ã§ç¨¼ããªãŒã‚‰ç”Ÿæ´»ã€‚å¥½ããªä»•äº‹ã‚’ç¶šã‘ã¤ã¤ã€å¿…è¦æœ€ä½é™ã®åå…¥ã‚’å¾—ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã§ã™ã€‚';
            } else if (!hasSideJob && hasFireWork) {
                fireStyle = 'ãƒãƒªã‚¹ã‚¿FIRE';
                fireStyleDesc = 'ä¼šç¤¾ã‚’è¾ã‚ãŸå¾Œã€ãƒ‘ãƒ¼ãƒˆãƒ»ã‚¢ãƒ«ãƒã‚¤ãƒˆã§åƒããªãŒã‚‰ç”Ÿæ´»ã€‚é€±æ•°æ—¥ã®åŠ´åƒã§åå…¥ã‚’å¾—ã¦ã€åšç”Ÿå¹´é‡‘ã‚’ç¶™ç¶šã§ãã‚‹å ´åˆãŒã‚ã‚Šã¾ã™ã€‚';
            } else {
                fireStyle = 'ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å‹FIRE';
                fireStyleDesc = 'ä¼šç¤¾ã‚’è¾ã‚ãŸå¾Œã€å‰¯æ¥­ã¨ãƒ‘ãƒ¼ãƒˆåŠ´åƒã®ä¸¡æ–¹ã§åå…¥ã‚’å¾—ã‚‹ã‚¹ã‚¿ã‚¤ãƒ«ã€‚åå…¥æºãŒè¤‡æ•°ã‚ã‚‹ãŸã‚ã€ãƒªã‚¹ã‚¯åˆ†æ•£ãŒã§ãã¾ã™ã€‚';
            }
            
            // FIREé”æˆå¹´åˆ¤å®š
            const fireAge = parseInt(document.getElementById('fireAge').value);
            let fireAchieved = false;
            let fireYear = null;
            
            for (let i = 0; i < cashflowData.length; i++) {
                if (cashflowData[i].age >= fireAge) {
                    let allPositive = true;
                    for (let j = i; j < cashflowData.length; j++) {
                        if (cashflowData[j].netAsset <= 0) {
                            allPositive = false;
                            break;
                        }
                    }
                    if (allPositive) {
                        fireAchieved = true;
                        fireYear = cashflowData[i].year;
                        break;
                    }
                }
            }
            
            const fireAgeAtAchievement = fireAchieved ? cashflowData.find(d => d.year === fireYear).age : 'æœªé”æˆ';
            const fireAssets = fireAchieved ? cashflowData.find(d => d.year === fireYear).netAsset : 0;
            
            // çµæœè¡¨ç¤º
            let html = `
                <div class="fire-style-box">
                    <h3>ã‚ãªãŸã®FIREã‚¹ã‚¿ã‚¤ãƒ«ï¼š${fireStyle}</h3>
                    <p>${fireStyleDesc}</p>
                    <div class="fire-info">
                        <div class="fire-info-item">
                            <strong>FIREé”æˆå¹´</strong>
                            <span>${fireAchieved ? fireYear + 'å¹´ï¼ˆ' + fireAgeAtAchievement + 'æ­³ï¼‰' : 'ç›®æ¨™é”æˆå›°é›£'}</span>
                        </div>
                        <div class="fire-info-item">
                            <strong>FIREæ™‚ã®è³‡ç”£</strong>
                            <span>${fireAchieved ? fireAssets.toLocaleString() + 'ä¸‡å††' : '-'}</span>
                        </div>
                        <div class="fire-info-item">
                            <strong>æœ€çµ‚è³‡ç”£é¡</strong>
                            <span>${cashflowData[cashflowData.length-1].netAsset.toLocaleString()}ä¸‡å††</span>
                        </div>
                    </div>
                </div>
            `;
            
            if (!fireAchieved) {
                html += `
                    <div class="note" style="background: #f8d7da; border-color: #dc3545;">
                        <strong>âš ï¸ è­¦å‘Š</strong><br>
                        ç¾åœ¨ã®è¨­å®šã§ã¯ã€FIREç›®æ¨™å¹´é½¢ã«åˆ°é”ã—ã¦ã‚‚è³‡ç”£ãŒä¸è¶³ã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
                        ä»¥ä¸‹ã‚’æ¤œè¨ã—ã¦ãã ã•ã„ï¼š<br>
                        â€¢ å‰¯æ¥­åå…¥ã‚’å¢—ã‚„ã™<br>
                        â€¢ FIREå¾Œã‚‚åƒãæœŸé–“ã‚’å»¶ã°ã™<br>
                        â€¢ æ”¯å‡ºã‚’è¦‹ç›´ã™<br>
                        â€¢ FIREç›®æ¨™å¹´é½¢ã‚’é…ã‚‰ã›ã‚‹
                    </div>
                `;
            }
            
            // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼è¡¨
            html += `
                <h2 class="section-title">ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ•ãƒ­ãƒ¼è¡¨</h2>
                <button class="btn-secondary" onclick="downloadCSV()">ğŸ“¥ CSVå‡ºåŠ›</button>
                <div class="table-container" style="max-height: 500px; overflow-y: auto;">
                    <table>
                        <thead>
                            <tr>
                                <th>å¹´</th>
                                <th>å¹´é½¢</th>
                                <th class="important-col">åå…¥è¨ˆ</th>
                                <th class="important-col">æ”¯å‡ºè¨ˆ</th>
                                <th class="important-col">åæ”¯</th>
                                <th class="important-col">ç´”è³‡ç”£</th>
                                <th>æœ¬æ¥­</th>
                                <th>å‰¯æ¥­</th>
                                <th>FIREå¾ŒåŠ´åƒ</th>
                                <th>é‹ç”¨ç›Š</th>
                                <th>å¹´é‡‘</th>
                                <th>ç¨ãƒ»ç¤¾ä¿</th>
                                <th>ç”Ÿæ´»è²»</th>
                                <th>æ•™è‚²è²»</th>
                                <th>ãƒ­ãƒ¼ãƒ³</th>
                                <th>ãã®ä»–</th>
                                <th>ç·è³‡ç”£</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            cashflowData.forEach(row => {
                const rowClass = row.cashflow < 0 ? 'style="color: red;"' : '';
                html += `
                    <tr ${rowClass}>
                        <td>${row.year}</td>
                        <td>${row.age}</td>
                        <td class="important-col">${row.totalIncome.toLocaleString()}</td>
                        <td class="important-col">${row.totalExpenses.toLocaleString()}</td>
                        <td class="important-col">${row.cashflow.toLocaleString()}</td>
                        <td class="important-col">${row.netAsset.toLocaleString()}</td>
                        <td>${row.mainIncome.toLocaleString()}</td>
                        <td>${row.sideJobIncome.toLocaleString()}</td>
                        <td>${row.fireWorkIncome.toLocaleString()}</td>
                        <td>${row.investmentReturn.toLocaleString()}</td>
                        <td>${row.pension.toLocaleString()}</td>
                        <td>${row.taxAndSocial.toLocaleString()}</td>
                        <td>${row.monthlyExpenses.toLocaleString()}</td>
                        <td>${row.educationCost.toLocaleString()}</td>
                        <td>${row.loanPayment.toLocaleString()}</td>
                        <td>${row.otherExpenses.toLocaleString()}</td>
                        <td>${row.totalAsset.toLocaleString()}</td>
                    </tr>
                `;
            });
            
            html += `
                        </tbody>
                    </table>
                </div>
            `;
            
            // ã‚°ãƒ©ãƒ•
            html += `
                <h2 class="section-title">ã‚°ãƒ©ãƒ•</h2>
                <div class="chart-grid">
                    <div>
                        <h3>è³‡ç”£æ¨ç§»</h3>
                        <div class="chart-container">
                            <canvas id="assetChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3>å¹´é–“åæ”¯</h3>
                        <div class="chart-container">
                            <canvas id="cashflowChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3>åå…¥æ§‹æˆæ¯”</h3>
                        <div class="chart-container">
                            <canvas id="incomeChart"></canvas>
                        </div>
                    </div>
                    <div>
                        <h3>æ”¯å‡ºæ§‹æˆæ¯”</h3>
                        <div class="chart-container">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                </div>
            `;
            
            document.getElementById('resultsContent').innerHTML = html;
            
            // ã‚°ãƒ©ãƒ•æç”»
            setTimeout(() => {
                drawCharts(fireYear);
            }, 100);
            
            // çµæœã‚¿ãƒ–ã«åˆ‡ã‚Šæ›¿ãˆ
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.querySelector('.tab:last-child').classList.add('active');
            document.getElementById('results').classList.add('active');
        }
        
        function drawCharts(fireYear) {
            // æ—¢å­˜ã®ãƒãƒ£ãƒ¼ãƒˆã‚’ç ´æ£„
            Object.values(charts).forEach(chart => chart.destroy());
            charts = {};
            
            const years = cashflowData.map(d => d.year);
            
            // è³‡ç”£æ¨ç§»
            const assetCtx = document.getElementById('assetChart').getContext('2d');
            charts.asset = new Chart(assetCtx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'ç´”è³‡ç”£',
                        data: cashflowData.map(d => d.netAsset),
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        borderWidth: 3,
                        fill: true
                    }, {
                        label: 'ç·è³‡ç”£',
                        data: cashflowData.map(d => d.totalAsset),
                        borderColor: '#48bb78',
                        backgroundColor: 'rgba(72, 187, 120, 0.1)',
                        borderWidth: 2,
                        borderDash: [5, 5],
                        fill: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'top' },
                        annotation: fireYear ? {
                            annotations: [{
                                type: 'line',
                                xMin: fireYear,
                                xMax: fireYear,
                                borderColor: 'red',
                                borderWidth: 2,
                                borderDash: [5, 5],
                                label: {
                                    content: 'FIREé”æˆ',
                                    enabled: true,
                                    position: 'top'
                                }
                            }]
                        } : {}
                    },
                    scales: {
                        y: { beginAtZero: false }
                    }
                }
            });
            
            // å¹´é–“åæ”¯
            const cashflowCtx = document.getElementById('cashflowChart').getContext('2d');
            charts.cashflow = new Chart(cashflowCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'å¹´é–“åæ”¯',
                        data: cashflowData.map(d => d.cashflow),
                        backgroundColor: cashflowData.map(d => d.cashflow >= 0 ? 'rgba(72, 187, 120, 0.8)' : 'rgba(245, 101, 101, 0.8)')
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true } }
                }
            });
            
            // åå…¥æ§‹æˆæ¯”
            const incomeCtx = document.getElementById('incomeChart').getContext('2d');
            charts.income = new Chart(incomeCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'æœ¬æ¥­',
                        data: cashflowData.map(d => d.mainIncome),
                        backgroundColor: '#667eea'
                    }, {
                        label: 'å‰¯æ¥­',
                        data: cashflowData.map(d => d.sideJobIncome),
                        backgroundColor: '#f6ad55'
                    }, {
                        label: 'FIREå¾ŒåŠ´åƒ',
                        data: cashflowData.map(d => d.fireWorkIncome),
                        backgroundColor: '#fbd38d'
                    }, {
                        label: 'é‹ç”¨ç›Š',
                        data: cashflowData.map(d => d.investmentReturn),
                        backgroundColor: '#48bb78'
                    }, {
                        label: 'å¹´é‡‘',
                        data: cashflowData.map(d => d.pension),
                        backgroundColor: '#90cdf4'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true, beginAtZero: true }
                    }
                }
            });
            
            // æ”¯å‡ºæ§‹æˆæ¯”
            const expenseCtx = document.getElementById('expenseChart').getContext('2d');
            charts.expense = new Chart(expenseCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'ç”Ÿæ´»è²»',
                        data: cashflowData.map(d => d.monthlyExpenses),
                        backgroundColor: '#667eea'
                    }, {
                        label: 'æ•™è‚²è²»',
                        data: cashflowData.map(d => d.educationCost),
                        backgroundColor: '#f6ad55'
                    }, {
                        label: 'ãƒ­ãƒ¼ãƒ³è¿”æ¸ˆ',
                        data: cashflowData.map(d => d.loanPayment),
                        backgroundColor: '#fc8181'
                    }, {
                        label: 'ç¨é‡‘ãƒ»ç¤¾ä¿',
                        data: cashflowData.map(d => d.taxAndSocial),
                        backgroundColor: '#a0aec0'
                    }, {
                        label: 'ãã®ä»–',
                        data: cashflowData.map(d => d.otherExpenses),
                        backgroundColor: '#48bb78'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { position: 'top' } },
                    scales: {
                        x: { stacked: true },
                        y: { stacked: true, beginAtZero: true }
                    }
                }
            });
        }
        
        function downloadCSV() {
            let csv = 'Year,Age,Total Income,Total Expenses,Cashflow,Net Asset,Main Income,Side Job,FIRE Work,Investment Return,Pension,Tax & Social,Living Expenses,Education,Loan,Other,Total Asset\n';
            
            cashflowData.forEach(row => {
                csv += `${row.year},${row.age},${row.totalIncome},${row.totalExpenses},${row.cashflow},${row.netAsset},${row.mainIncome},${row.sideJobIncome},${row.fireWorkIncome},${row.investmentReturn},${row.pension},${row.taxAndSocial},${row.monthlyExpenses},${row.educationCost},${row.loanPayment},${row.otherExpenses},${row.totalAsset}\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'fire_simulation.csv';
            link.click();
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿å¾©å…ƒ
        window.addEventListener('load', loadData);
    </script>
</body>
</html>